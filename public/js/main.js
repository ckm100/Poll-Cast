function deletePoll(){var e,l;$(".delete-icon").click(function(){e=$(this).next().next().attr("data-pollId"),l=$(this).next().next().attr("data-userId"),$(".overlay").show(),$(".delete-poll-warning-dialog").show()}),$(".poll-delete-confirm").click(function(){$(".delete-poll-warning-dialog").hide(),$(".loader-message").show(),$(".loader-message").html("Deleting Poll..."),$(".loader-container").show(),$.ajax({method:"POST",url:"/deletePoll",data:{pollId:e,userId:l},success:function(e){$(".loader").hide(),$(".loader-message").html("Poll Deleted Successful!"),$(".loader-message").css("color","green"),setTimeout(function(){window.location.reload()},1e3)},error:function(e){$(".loader").hide(),$(".loader-message").html("Error Deleting Poll, Please Try Again"),$(".loader-message").css("color","red"),$(".close-btn").show()}})})}for(var canvas=document.querySelectorAll(".canvas"),overlay=$(".overlay"),loginDialog=$(".login-dialog"),SignupDialog=$(".signup-dialog"),pollDialog=$(".poll-add-dialog"),clen=canvas.length,label=document.querySelectorAll(".label"),labelVal=$(".label").attr("data-value"),dlen=label.length,data=[],copydata=[],copyChart=[],ctx,colors=["#F7464A","#113F8C","#FDB45C","#01A4A4","#61AE24","#D0D102","#32742C","#D70060","#E54028","#F18D05","#EA3556","#61D2D6","#ED146F","#EDDE45","#FFF0CF","#DD577A","#FE5A27","#49AEC0","#35235D","#DB2464","#CB2402","#9505D5","#12011A","#F274D0","#B2EAAE","#070723","#794341","#B28969","#E5C48E","#EF8E1F","#704475","#561829","#CE6423"],highlights=["#FF5A5E","#5AD3D1","#FFC870","#5E0525","#740025","#CE0027","#FC7C3D","#DD577A","#FFF0CF","#FE5A27","#49AEC0","#131723","#4C49A2","#A31A48","#96F7B2","#427B6C","#E6E7A1","#7F66C2","#BB3200","#D1A04B","#FF2E61","#FF3B19","#081010","#D11589","#D0F2F1","#C1E8D8","#A3BBC2","#9F7BAB","#554E5D"],totalPollVal,i=0;clen>i;i++){for(var d=0;d<label[i].value.split(",").length;d++)data.push({value:label[i].dataset.value.split(",")[d],color:label[i].dataset.colors.split(",")[d],highlight:label[i].dataset.highlights.split(",")[d],label:label[i].value.split(",")[d]});totalPollVal=label[i].dataset.value.split(",").reduce(function(e,l){return parseInt(e)+parseInt(l)}),$(".total-pollcast")[i].innerHTML="Total Vote: "+totalPollVal,copydata.push(data),ctx=canvas[i].getContext("2d");var pie=new Chart(ctx).Pie(data,{legendTemplate:'<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<segments.length; i++){%><li><span style="background-color:<%=segments[i].fillColor%>; width:20px; height:20px; display:inline-block; vertical-align:bottom"></span>&nbsp;<%if(segments[i].label){%><%=segments[i].label%><%}%>&nbsp;&#45;&nbsp;<%if(segments[i].value){%><%=segments[i].value%><%}%></li><%}%></ul>',animateRotate:!1});$($(".poll-template")[i]).append(pie.generateLegend()),copyChart.push(pie),data=[]}$("#sign-in").click(function(){overlay.show(),loginDialog.slideDown()}),$(".top").click(function(){$("html,body").animate({scrollTop:$(".polls-container").offset().top},1e3)}),$("#sign-up").click(function(){overlay.show(),SignupDialog.slideDown()}),$(".sign-up-btn").click(function(){overlay.show(),SignupDialog.slideDown()}),$(".no-account-btn").click(function(){loginDialog.slideUp(),SignupDialog.slideDown()}),$(".have-account-btn").click(function(){loginDialog.slideDown(),SignupDialog.slideUp()}),$(".add-more-btn").click(function(e){$(".poll-add-dialog").height()>=600&&$(".poll-add-dialog").css({height:"600px",overflow:"scroll"});var l=document.createElement("input");l.setAttribute("type","text"),l.setAttribute("placeholder","New Option"),$(".options-container").append(l)}),$("input").blur(function(){""!==$(".poll-option1").val()&&""!==$(".poll-option2").val()?$(".publish-btn").prop("disabled",!1):$(".publish-btn").prop("disabled",!0)}),$(".poll-name").focus(function(){""===$(this).val()?$(".poll-name-tooltip").show(800):$(".poll-name-tooltip").hide(800)}),$(".poll-name").blur(function(){$(".poll-name-tooltip").is(":visible")&&$(".poll-name-tooltip").hide(800)}),$(".publish-btn").click(function(e){var l=$(".options-container").children(),o=l.length,r=[],i=[],a=[],n=[];$(".poll-add-general-error").is(":visible")&&$(".poll-add-general-error").hide();for(var t=0;o>t;t++)""!==l[t].value&&(r.push(l[t].value),i.push(1),a.push(colors[Math.floor(33*Math.random())]),n.push(highlights[Math.floor(29*Math.random())]));""===$(".poll-name").val()?($(".poll-name-error").show(),$(".poll-name").css({border:"2px solid red",outline:"none"})):($(".poll-name").css("border","1px solid gray"),$(".poll-name-error").hide(),e.target.innerHTML="Publishing...",$(this).prop("disabled",!0),$.ajax({method:"POST",url:"/addPoll",data:{title:$(".poll-name").val(),label:r,value:i,color:a,highlight:n},success:function(l){l.success===!0&&(e.target.innerHTML="Publish",$(".publish-btn").prop("disabled",!1),window.location.reload())},error:function(e){$(".poll-add-general-error").show()}}))}),$(".close-icon").click(function(){loginDialog.is(":visible")?(overlay.hide(),$(".login-email-password-error, .login-email-error, .login-password-error,.email-invalid-error,.password-invalid-error,.general-error").hide(),loginDialog.slideUp()):SignupDialog.is(":visible")?(overlay.hide(),$(".login-firstname-email-password-error, .login-firstname-error,.login-email-error,.login-password-error,.email-exist-error,.general-error").hide(),SignupDialog.slideUp()):pollDialog.is(":visible")&&(overlay.hide(),$(".poll-name-error").hide(),pollDialog.slideUp())}),$(".hover-bg").click(function(){$(".overlay").show(),$(".poll-add-dialog").slideDown(),$(".poll-add-dialog").css("top",$(document).scrollTop())}),$(document).scroll(function(){$(".poll-add-dialog").is(":visible")&&$(".poll-add-dialog").css("top",$(document).scrollTop()),$(document).scrollTop()>=1530?$(".top").show():$(".top").hide()}),$(".login-btn").click(function(e){var l=$("#login-email").val(),o=$("#login-pword").val();""===l&&""===o?($(".login-email-password-error").show(),$(".login-email-error, .login-password-error").hide()):""===l?($(".login-email-error").show(),$(".login-email-password-error, .login-password-error").hide()):""===o?($(".login-password-error").show(),$(".login-email-password-error, .login-email-error").hide()):""!==l&&""!==o&&($(".login-email-password-error, .login-email-error, .login-password-error,.email-invalid-error,.password-invalid-error,.general-error").hide(),$(".login-btn").html("Logging In..."),$(".login-btn").prop("disabled",!0),$.ajax({method:"POST",url:"/login",data:{email:l,password:o},success:function(e){0===parseInt(e.error)?($(".login-btn").html("Log In"),$(".login-btn").prop("disabled",!1),$(".email-invalid-error").show(),$(".password-invalid-error").hide()):1===parseInt(e.error)?($(".login-btn").html("Log In"),$(".login-btn").prop("disabled",!1),$(".password-invalid-error").show(),$(".email-invalid-error").hide()):($(".password-invalid-error").hide(),$(".email-invalid-error").hide(),$(".label").attr("data-isSharePage")&&"false"===$(".label").attr("data-isSharePage")?window.location.reload():window.location.href="/pollboard")},error:function(e){e&&($(".login-btn").html("Log In"),$(".login-btn").prop("disabled",!1),$(".password-invalid-error").hide(),$(".email-invalid-error").hide(),$(".general-error").show())}}))}),$(".signup-btn").click(function(){var e=$("#signup-fname").val(),l=$("#signup-email").val(),o=$("#signup-pword").val();""===e&&""===o&&""===l?($(".login-firstname-email-password-error").show(),$(".login-firstname-error, .login-email-error,.login-password-error").hide()):""===e?($(".login-firstname-error").show(),$(".login-firstname-email-password-error, .login-email-error,.login-password-error").hide()):""===l?($(".login-email-error").show(),$(".login-firstname-email-password-error, .login-firstname-error,.login-password-error").hide()):""===o?($(".login-password-error").show(),$(".login-firstname-email-password-error, .login-firstname-error,.login-email-error").hide()):""!==e&&""!==o&&""!==l&&($(".login-firstname-email-password-error, .login-firstname-error,.login-email-error,.login-password-error,.email-exist-error,.general-error").hide(),$(".signup-btn").html("Signing Up..."),$(".signup-btn").prop("disabled",!0),$.ajax({method:"POST",url:"/signup",data:{uname:e[0].toUpperCase()+e.substring(1,e.length),email:l,password:o},success:function(e){0===parseInt(e.error)?($(".signup-btn").html("Sign Up"),$(".signup-btn").prop("disabled",!1),$(".email-exist-error").show()):($(".email-exist-error").hide(),$(".label").attr("data-isSharePage")&&"false"===$(".label").attr("data-isSharePage")?window.location.reload():window.location.href="/pollboard")},error:function(e){e&&($(".signup-btn").html("Sign Up"),$(".signup-btn").prop("disabled",!1),$(".email-exist-error").hide(),$(".general-error").show())}}))}),$("canvas").click(function(e){var l=copyChart[+$(this).attr("data-counter")],o=l.getSegmentsAtEvent(e),r=$(this).attr("data-pollId"),i=$(this).attr("data-userId"),a=+o[0].value+1,n=o[0].label,t=$(this),s=t.next().next().next().children().children();o[0].value=a,$(".overlay").show(),$(".loader-message").show(),$(".loader-message").html("Voting..."),$(".loader-container").show(),$.ajax({method:"POST",url:"/vote",data:{pollId:r,userId:i,vote:a,label:n},success:function(e){$(".loader").hide(),$(".loader-message").html("Voting Done!"),$(".loader-message").css("color","green"),$(".close-btn").show(),l.update(),t.next().next().html("Total Vote: "+l.total);for(var r=0;r<s.length;r++)if(o[0].label==s[r].innerText.split("-")[0].trim()){var i=s[r].innerHTML.substring(s[r].innerHTML.indexOf("<"),s[r].innerHTML.lastIndexOf(">")+1);s[r].innerHTML=i+" "+o[0].label+" - "+o[0].value}},error:function(e){$(".loader").hide(),$(".loader-message").html("Error Voting, Please Try Again"),$(".loader-message").css("color","red"),$(".close-btn").show()}})}),$(".close-btn").click(function(){$(".loader").show(),$(".loader-container").hide(),$(".loader-message").css("color","#000"),$(".loader-message").hide(),$(".overlay").hide(),$(".loader-message").html("")}),$(".poll-delete-decline").click(function(){$(".overlay").hide(),$(".delete-poll-warning-dialog").hide()}),deletePoll(),$(".logout").click(function(e){$.ajax({method:"GET",url:"/logout",success:function(){window.location.href="/"}})});